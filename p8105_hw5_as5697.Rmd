---
title: "P8105 Homework 5"
author: "Apoorva Srinivasan"
date: "11/.3/2018"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
```

```{r}
p1_data = list.files("./data", full.names = TRUE) 

p1_df = map(p1_data, read_csv) 

for (i in 1:20) {
  if (i < 11) {
    p1_df[[i]] = p1_df[[i]] %>% 
    mutate(study_id = i, arm = "Control")
  } else if (i > 10) {
    p1_df[[i]] = p1_df[[i]] %>% 
      mutate(study_id = i - 10, arm = "Experimental")
  }
}


p1_tidy = p1_df %>%
  bind_rows() %>%
  gather(key = week, value = observation, week_1:week_8) %>%
  separate(week, into = c("delete", "week"), sep = "_") %>%
  select(study_id, arm, everything(), -(delete)) %>%
  arrange(study_id, week) %>%
  mutate(week = as.integer(week), 
         study_id = as.character(study_id))

p1_tidy

```
Spaghetti plot

```{r}
p1_tidy %>%
  group_by(arm, study_id) %>% 
  ggplot(aes(x = week, y = observation, color = arm, type = study_id)) + 
    geom_line() +
  labs(title = "Observations on each subject over time",
       x = "Week", 
       y = "Observation")
```



###PROBLEM 2


```{r}
homicide = read_csv("./homicide-data.csv")
```

```{r}
homicide = homicide %>%
   mutate(city_state = str_c(city, ", ", state),
         disposition = as.factor(disposition))

```

```{r}
n_per_city = homicide %>%
  group_by(city_state) %>%
  count()


n_unsolved = homicide %>%
  group_by(city_state) %>%
  filter(disposition %in% c("Closed without arrest", "Open/No arrest")) %>%
  count()
```



